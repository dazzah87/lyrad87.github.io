<!DOCTYPE html>
<html>
	<head>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		<script>
			$(document).ready(function() {
				$("button").click(function() {
					var bungieAPIkey = '0a11942f318647978979f13ad8aa53ee';
					var memberIds = [];
					var clanPvPKills = 0;
					var clanPvPDeaths = 0;
					var clanPvPGamesWon = 0;
					var clanPvPSecondsPlayed = 0;
					var clanPvEKills = 0;
					var clanPvEDeaths = 0;
					var clanPvESuicides = 0;
					var clanPvEHPECompleted = 0;
					var clanPvEAdventuresCompleted = 0;
					var clanPvESecondsPlayed = 0;

					$.ajax({
						//get member infos from our clan
						url: 'https://www.bungie.net/Platform/GroupV2/1801684/Members/',
						headers: {'X-API-KEY': bungieAPIkey },
						method: 'GET',
						success: function(data) {
							//collect id strings from every clan member
							$.each(data.Response.results, function(index, value) {
								memberIds.push(value.destinyUserInfo.membershipId);
							});

							//iterate over every member
							$.each(memberIds, function(index, memberid) {
								$.ajax({
									url: 'https://www.bungie.net/Platform/Destiny2/2/Account/' + memberid + '/Stats/',
									headers: {'X-API-KEY': bungieAPIkey },
									method: 'GET',
									success: function(data) {
										clanPvPKills = clanPvPKills + data.Response.mergedAllCharacters.results.allPvP.allTime.kills.basic.value;
										clanPvPDeaths = clanPvPDeaths + data.Response.mergedAllCharacters.results.allPvP.allTime.deaths.basic.value;
										clanPvPGamesWon = clanPvPGamesWon + data.Response.mergedAllCharacters.results.allPvP.allTime.activitiesWon.basic.value;
										clanPvPSecondsPlayed = clanPvPSecondsPlayed + data.Response.mergedAllCharacters.results.allPvP.allTime.secondsPlayed.basic.value;
										clanPvEKills = clanPvEKills + data.Response.mergedAllCharacters.results.allPvE.allTime.kills.basic.value;
										clanPvEDeaths = clanPvEDeaths + data.Response.mergedAllCharacters.results.allPvE.allTime.deaths.basic.value;
										clanPvESuicides = clanPvESuicides + data.Response.mergedAllCharacters.results.allPvE.allTime.suicides.basic.value;
										clanPvEHPECompleted = clanPvEHPECompleted + data.Response.mergedAllCharacters.results.allPvE.allTime.heroicPublicEventsCompleted.basic.value;
										clanPvEAdventuresCompleted = clanPvEAdventuresCompleted + data.Response.mergedAllCharacters.results.allPvE.allTime.adventuresCompleted.basic.value;
										clanPvESecondsPlayed = clanPvESecondsPlayed + data.Response.mergedAllCharacters.results.allPvE.allTime.secondsPlayed.basic.value;
										$('#info').html(
												  'clan pvp kills: ' + (clanPvPKills).toLocaleString('en')
											+ '<br>clan pvp deaths: ' + (clanPvPDeaths).toLocaleString('en')	  
											+ '<br>clan pvp games won: ' + (clanPvPGamesWon).toLocaleString('en')
											+ '<br>clan pvp seconds played: ' + (clanPvPSecondsPlayed).toLocaleString('en')
											+ '<br><br>clan pve kills: ' + (clanPvEKills).toLocaleString('en')
											+ '<br>clan pve deaths: ' + (clanPvEDeaths).toLocaleString('en')
											+ '<br>clan pve suicides: ' + (clanPvESuicides).toLocaleString('en')
											+ '<br>clan pve heroic public events completed: ' + (clanPvEHPECompleted).toLocaleString('en')
											+ '<br>clan pve adventures completed: ' + (clanPvEAdventuresCompleted).toLocaleString('en')
											+ '<br>clan pve seconds played: ' + (clanPvESecondsPlayed).toLocaleString('en')
										);
									}
								});
							});
						}
					});
				});
			});
		</script>
	</head>
	<body>
		<button>fetch clan data</button></br></br><div id="info"></div>
	</body>
</html>